# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RAG ULTRA v0.1

## üèõÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph LR
    A[–î–æ–∫—É–º–µ–Ω—Ç—ã] --> B[–ü–∞—Ä—Å–∏–Ω–≥]
    B --> C[–ß–∞–Ω–∫–∏–Ω–≥]
    C --> D[–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è]
    D --> E[–ò–Ω–¥–µ–∫—Å FAISS]
    
    F[–ó–∞–ø—Ä–æ—Å] --> G[–≠–º–±–µ–¥–¥–∏–Ω–≥]
    G --> H[–ü–æ–∏—Å–∫ –≤ FAISS]
    H --> I[–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ]
    I --> J[–ö–æ–Ω—Ç–µ–∫—Å—Ç]
    J --> K[–û—Ç–≤–µ—Ç]
    
    E --> H
```

## üìÇ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 1. –ü–∞—Ä—Å–µ—Ä—ã (`parsers/`)
–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤:

- **pdf_parser.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ PDF —Å OCR –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü
- **docx_parser.py** - –ø–∞—Ä—Å–∏–Ω–≥ Word –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **excel_csv_parser.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü Excel/CSV
- **pptx_parser.py** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
- **doc_binary_parser.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö .doc —Ñ–∞–π–ª–æ–≤
- **html_md_parser.py** - –ø–∞—Ä—Å–∏–Ω–≥ HTML –∏ Markdown
- **txt_parser.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- **pg_loader.py** - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ PostgreSQL

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ (`doc_ingest/`)

#### –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω:
1. **1.main_parse_doc.py** - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. **2.main_build_doc_fields_index.py** - —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
3. **3.main_build_field_lexicon.py** - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è
4. **4.main_embed.py** - –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏:
- **chunking.py** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏
- **embed_utils.py** - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏
- **embed_faiss.py** - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ FAISS –∏–Ω–¥–µ–∫—Å–∞
- **embed_qdrant.py** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Qdrant (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **graph_builder.py** - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### 3. –ü–æ–∏—Å–∫ –∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (`retrieval/`)

- **searcher.py** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º—É –∏–Ω–¥–µ–∫—Å—É
- **universal_searcher.py** - –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (semantic + lexical)
- **reranker.py** - –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Å CrossEncoder
- **context_builder.py** - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è LLM

### 4. API —Å–µ—Ä–≤–∏—Å (`service/`)

- **search_api.py** - FastAPI —Å–µ—Ä–≤–µ—Ä —Å REST API

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –≠—Ç–∞–ø –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:
```
–î–æ–∫—É–º–µ–Ω—Ç—ã ‚Üí –ü–∞—Ä—Å–∏–Ω–≥ ‚Üí DocElement ‚Üí –ß–∞–Ω–∫–∏–Ω–≥ ‚Üí Chunk ‚Üí –≠–º–±–µ–¥–¥–∏–Ω–≥ ‚Üí FAISS Index
                ‚Üì                      ‚Üì                    ‚Üì
           –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ              –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ          –í–µ–∫—Ç–æ—Ä—ã
           –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π             (JSON)              (NPZ/Index)
```

### –≠—Ç–∞–ø –ø–æ–∏—Å–∫–∞:
```
–ó–∞–ø—Ä–æ—Å ‚Üí –≠–º–±–µ–¥–¥–∏–Ω–≥ ‚Üí –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ ‚Üí Top-K –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ ‚Üí –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ö–æ–Ω—Ç–µ–∫—Å—Ç
            ‚Üì              ‚Üì                    ‚Üì              ‚Üì
        Query vector    FAISS search      –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è    CrossEncoder
                                          –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º   scoring
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### DocElement
–ë–∞–∑–æ–≤–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞:
```python
@dataclass
class DocElement:
    text: str                    # —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
    element_type: str            # paragraph/heading/table/formula
    category: Optional[str]      # –∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
    doc_id: Optional[str]        # ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
    doc_path: Optional[str]      # –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
    page: Optional[int]          # –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    order: Optional[int]         # –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    heading_path: List[str]      # –∏–µ—Ä–∞—Ä—Ö–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    media_refs: List[str]        # —Å—Å—ã–ª–∫–∏ –Ω–∞ –º–µ–¥–∏–∞
```

### Chunk
–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞:
```python
@dataclass
class Chunk:
    text: str                    # –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    doc_id: str                  # –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É
    chunk_index: int             # –∏–Ω–¥–µ–∫—Å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
    page_from: Optional[int]     # –Ω–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    page_to: Optional[int]       # –∫–æ–Ω–µ—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    heading_path: List[str]      # –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    element_types: List[str]     # —Ç–∏–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —á–∞–Ω–∫–µ
```

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
1. **–ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤** - –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
3. **FAISS –∏–Ω–¥–µ–∫—Å** - –±—ã—Å—Ç—Ä—ã–π –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (IVF)
4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ö–∞—á–µ—Å—Ç–≤–æ:
1. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —á–∞–Ω–∫–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–º—ã—Å–ª–æ–≤–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
2. **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** - —É—á–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞
3. **–ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–æ–º–±–∏–Ω–∞—Ü–∏—è cosine + CrossEncoder
4. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ —Ç–æ–∫–µ–Ω-–±—é–¥–∂–µ—Ç LLM

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ `config.py`:

- **PipelineConfig** - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **EmbeddingConfig** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —á–∞–Ω–∫–∏–Ω–≥–∞
- **RerankerConfig** - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è
- **ContextConfig** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- Latency –ø–æ–∏—Å–∫–∞: < 200ms (CPU), < 50ms (GPU)
- Recall@10: > 0.85
- Precision@5: > 0.75
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: 50+ RPS

### –¢–æ—á–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
1. –í—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (docs/sec)
3. Latency –ø–æ–∏—Å–∫–∞ (p50, p95, p99)
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏–Ω–¥–µ–∫—Å–æ–º
5. Cache hit rate

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### v0.2 (Q2 2025):
- [ ] –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- [ ] Multi-index –ø–æ–∏—Å–∫
- [ ] Streaming –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] GraphRAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### v0.3 (Q3 2025):
- [ ] Multimodal –ø–æ–∏—Å–∫ (—Ç–µ–∫—Å—Ç + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- [ ] Fine-tuning –º–æ–¥–µ–ª–µ–π –Ω–∞ –∫–æ—Ä–ø—É—Å–µ
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] Distributed –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞:
1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ `parsers/`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `parse_<format>(path, category, **kwargs) -> List[DocElement]`
3. –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç–∏–Ω–≥ –≤ `route_parse()` –≤ `1.main_parse_doc.py`
4. –û–±–Ω–æ–≤–∏—Ç—å `SUPPORTED` —Ñ–æ—Ä–º–∞—Ç—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞:
1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `embed_<index>.py`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ –ø–æ–∏—Å–∫–∞
3. –û–±–Ω–æ–≤–∏—Ç—å `EmbeddingConfig.index_kind`
4. –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –≤ `4.main_embed.py`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# Unit —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–æ–≤
pytest tests/test_parsers.py

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø–∞–π–ø–ª–∞–π–Ω–∞
python test_rag_system.py

# –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
locust -f tests/load_test.py
```

## üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: SentenceTransformers (SBERT)
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: FAISS (Facebook AI)
- **–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ**: CrossEncoder
- **API**: FastAPI + Uvicorn
- **–ü–∞—Ä—Å–∏–Ω–≥**: LangChain Unstructured
- **OCR**: Tesseract
- **–ì—Ä–∞—Ñ—ã**: NetworkX

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –¥–ª—è –≤–µ—Ä—Å–∏–∏ 0.1*
